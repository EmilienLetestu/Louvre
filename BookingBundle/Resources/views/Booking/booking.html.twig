{% extends "ELBookingBundle::layout.html.twig" %}

{% block title %}{{ parent() }} - Commande des tickets  {% endblock %}

{% block body %}
    <div class="col-sm-12">
        <h1 id ="booking_title">Commander mes tickets pour ma visite du {{ app.session.get('user_date') }}</h1>
    </div>
    <div class="col-sm-5">
        {{ form_start(order_form) }}
        {{ form_row(order_form.tickets) }}
        <a href="#" id="add_ticket" class="btn btn-default">Ajouter un billet</a>
        {{ form_end(order_form) }}
    </div>
    {% if (app.session.get('order') != null)%}
        {% set order_in_progress = app.session.get('order')  %}
      <div class="col-sm-7">
              <table class="table table-responsive table-striped table-hover">
                <thead>
                    <tr>
                        <th>Porteur du billet</th>
                        <th>Valable le</th>
                        <th>Type de billet</th>
                        <th>Prix du billet</th>
                        <th>Modifier</th>
                        <th>Supprimer</th>
                    </tr>
                </thead>
        {% for key,ticket in order_in_progress %}
                <tbody>
                    <tr>
                        <td>{{ ticket.name }} {{ ticket.surname }}</td>
                        <td>{{ ticket.date }}</td>
                        <td>{{ ticket.timeAccessType }} ,{{ ticket.priceType }}</td>
                        <td>{{ ticket.price }} €</td>
                    </tr>
                </tbody>
        {% endfor %}
              </table>
            </div>
            <div class = "col-sm-3" id="quote_for_order">
                <p>Nombre de billets :{{ app.session.get('number_of_tickets') }}</p>
                <p>Total de la commnade en cours :{{ app.session.get('total') }} €</p>
                <a class="btn btn-success" id="link_to_charge" href="{{ path('payer_commande') }}"> Payer </a>
            </div>
    {% endif %}
    <script type="text/javascript">
        $(document).ready(function() {
            var $container = $('div#order_tickets');
            var index = $container.find(':input').length;
            $('#add_ticket').click(function(e) {
                addTicket($container);
                e.preventDefault();
                return false;
            });
            if (index == 0) {
                addTicket($container);
            } else {
                $container.children('div').each(function() {
                    addDeleteLink($(this));
                });
            }
            function addTicket($container) {
                var template = $container.attr('data-prototype')
                        .replace(/__name__label__/g, 'Ticket n°' + (index+1))
                        .replace(/__name__/g,        index)
                    ;
                var $prototype = $(template);
                addDeleteLink($prototype);
                $container.append($prototype);
                index++;
            }
            function addDeleteLink($prototype) {
                var $deleteLink = $('<a href="#" class="btn btn-danger">Supprimer</a>');
                $prototype.append($deleteLink);
                $deleteLink.click(function(e) {
                    $prototype.remove();
                    e.preventDefault();
                    return false;
                });
            }
        });
    </script>
{% endblock %}